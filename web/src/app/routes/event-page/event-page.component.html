<div class="event" *ngIf="event">
  <app-login-form
    *ngIf="showLogin"
    (close)="closeLoginPopup($event)"
  ></app-login-form>
  <app-popup
    class="remove-popup"
    *ngIf="showRemove"
    title="Вы хотите удалить соревнование"
    (close)="closeRemovePopup($event)"
  >
    <div class="removePopupContent">
      <div class="removeEventDescription">
        Соревнование будет безвозвратно удалено.
      </div>
      <div class="buttons">
        <app-button
          class="removeEventButton"
          appearance="primary-red"
          (press)="removeEvent($event)"
          value="Удалить"
        >
        </app-button>
        <app-button
          class="cancelRemoveButton"
          appearance="secondary"
          (press)="closeRemovePopup($event)"
          value="Отмена"
        >
        </app-button>
      </div>
    </div>
  </app-popup>

  <app-popup
    *ngIf="showEdit"
    title="Редактировать"
    (close)="closeEditPopup($event)"
    width="600"
  >
    <form class="form" [formGroup]="editForm" (ngSubmit)="saveEvent($event)">
      <fieldset class="form-group">
        <app-input
          class="input"
          formControlName="name"
          placeholder="Name"
          defaultValue="{{ event.name }}"
        ></app-input>
        <app-input
          class="input"
          multiline
          placeholder="Описание"
          formControlName="description"
          defaultValue="{{ event.description }}"
        ></app-input>
        <div class="edit-cover-layout">
          <div
            *ngIf="coverMediaId"
            class="edit-cover-preview"
            [ngStyle]="editCoverPreviewStyle"
          ></div>
          <app-progress-bar
            *ngIf="uploading"
            class="edit-cover-upload-progress"
            [progress]="uploadProgress"
          ></app-progress-bar>
          <label *ngIf="!uploading" class="edit-cover-change">
            <input type="file" accept="image/*" (change)="upload($event)" />
            <app-button
              *ngIf="coverMediaId; else addCover"
              appearance="primary"
              value="Изменить"
            ></app-button>
            <ng-template #addCover
              ><app-button
                appearance="primary"
                value="Добавить картинку"
              ></app-button
            ></ng-template>
          </label>
          <app-button
            *ngIf="!uploading && coverMediaId"
            class="edit-cover-remove"
            appearance="primary"
            value="Удалить"
            (press)="removeCover()"
          ></app-button>
        </div>
        <app-switch
          formControlName="pair"
          label="Парное соревнование"
          [defaultValue]="paired"
        ></app-switch>
        <app-switch
          formControlName="publish"
          label="Опубликовать"
          [defaultValue]="published"
        ></app-switch>
        <div class="edit-date-layout">
          Начинается: <span class="filler"></span>
          <input
            type="date"
            formControlName="startsAtDate"
            [value]="startsAtDate"
          />
          <input
            type="time"
            formControlName="startsAtTime"
            [value]="startsAtTime"
          />
        </div>
        <div class="edit-date-layout">
          Заканчивается: <span class="filler"></span>
          <input
            type="date"
            formControlName="endsAtDate"
            [value]="endsAtDate"
          />
          <input
            type="time"
            formControlName="endsAtTime"
            [value]="endsAtTime"
          />
        </div>
        <app-submit
          class="input"
          value="Сохранить"
          [enabled]="!uploading"
        ></app-submit>
        <div
          class="toggleMore"
          [class.expanded]="expanded"
          (click)="toggleMore()"
        >
          <span>Другие действия</span>
        </div>
        <div *ngIf="expanded">
          <app-button
            class="remove-event"
            appearance="primary-red"
            value="Удалить соревнование"
            (press)="showRemovePopup($event)"
          ></app-button>
        </div>
      </fieldset>
    </form>
  </app-popup>
  <div class="top-panel">
    <app-header class="header">{{ event.name }}</app-header>
    <div class="buttons">
      <app-button class="button" (press)="goBack()" value="Back"></app-button>
      <app-button
        class="button"
        *ngIf="eventOwner"
        (press)="showEditPopup($event)"
        value="Edit"
      ></app-button>
    </div>
  </div>
  <div class="event-content">
    <div class="left">
      <div class="description text">{{ event.description }}</div>
      <div *ngIf="dateValid" class="date-container text">
        <div class="date-header">Дата</div>
        <div class="date">{{ date }}</div>
      </div>

      <app-button
        class="registerButton"
        appearance="positive"
        *ngIf="canRegister"
        (press)="register()"
        value="Записаться"
      >
      </app-button>

      <app-attendees-table
        *ngIf="pretenders.length > 0"
        [type]="event.type"
        [eventOwner]="eventOwner"
        (add)="accept($event)"
        (remove)="removeUser($event)"
        title="Возможные участники"
        [attendees]="pretenders"
      >
      </app-attendees-table>
      <app-attendees-table
        *ngIf="participants.length > 0"
        [eventOwner]="eventOwner"
        (remove)="removeUser($event)"
        title="Участники"
        [attendees]="participants"
      >
      </app-attendees-table>
      <app-attendees-table
        *ngIf="invited.length > 0"
        [eventOwner]="eventOwner"
        (remove)="removeUser($event)"
        title="Invited"
        [attendees]="invited"
      >
      </app-attendees-table>
    </div>
    <div class="right">
      <img
        *ngIf="event.coverMediaId"
        [src]="'http://localhost:3003/storage/' + event.coverMediaId"
      />
    </div>
  </div>
  <div class="removeButtonContainer">
    <app-button
      class="removeButton"
      appearance="dangerous"
      *ngIf="eventOwner"
      (press)="showRemovePopup($event)"
      value="Удалить соревнование"
    >
    </app-button>
  </div>
</div>
